"use strict";(self.webpackChunkcloudmydc_docs=self.webpackChunkcloudmydc_docs||[]).push([[6112],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>u});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},d="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=l(n),m=r,u=d["".concat(c,".").concat(m)]||d[m]||h[m]||o;return n?a.createElement(u,s(s({ref:t},p),{},{components:n})):a.createElement(u,s({ref:t},p))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=m;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[d]="string"==typeof e?e:r,s[1]=i;for(var l=2;l<o;l++)s[l]=n[l];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7008:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var a=n(87462),r=(n(67294),n(3905));const o={sidebar_position:4},s=void 0,i={unversionedId:"Memcached/PHP Sessions Clustering",id:"Memcached/PHP Sessions Clustering",title:"PHP Sessions Clustering",description:"The high availability of your PHP application can be achieved by implementing PHP sessions clustering in the cloud. To successfully handle application server failover we create environment with Memcached, several Apache servers, and an NGINX load balancer:",source:"@site/docs/Memcached/PHP Sessions Clustering.md",sourceDirName:"Memcached",slug:"/Memcached/PHP Sessions Clustering",permalink:"/docs/Memcached/PHP Sessions Clustering",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Memcached/PHP Sessions Clustering.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Memcached Memory Allocation",permalink:"/docs/Memcached/Memcached Memory Allocation"},next:{title:"Session Replication via Memcached",permalink:"/docs/Memcached/Session Replication via Memcached"}},c={},l=[{value:"How It Works",id:"how-it-works",level:2},{value:"How to Configure",id:"how-to-configure",level:2}],p={toc:l},d="wrapper";function h(e){let{components:t,...o}=e;return(0,r.kt)(d,(0,a.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The high availability of your PHP application can be achieved by implementing PHP sessions clustering in the cloud. To successfully handle application server failover we create environment with Memcached, several Apache servers, and an NGINX load balancer:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Log into the PaaS account.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click the ",(0,r.kt)("strong",{parentName:"p"},"Create environment")," button.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the ",(0,r.kt)("strong",{parentName:"p"},"Environment topology")," window choose two or more servers you want to use (for example, two instances of ",(0,r.kt)("strong",{parentName:"p"},"Apache"),") and ",(0,r.kt)("strong",{parentName:"p"},"Memcached")," node. Type the name of the environment and click ",(0,r.kt)("strong",{parentName:"p"},"Create"),"."))),(0,r.kt)("div",{style:{display:"flex",justifyContent:"center",margin:"0 0 1rem 0"}},(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Locale Dropdown",src:n(15100).Z,width:"942",height:"533"}))),(0,r.kt)("p",null,"The Memcached node is used as a distributed caching engine in the environment with multiple nodes. In our case, it provides a Web session with the sticky sessions running on several application servers. If one server fails, the sessions are stored for backup on the Memcached node. Other servers can fetch the sessions from Memcached and start serving the session."),(0,r.kt)("div",{style:{display:"flex",justifyContent:"center",margin:"0 0 1rem 0"}},(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Locale Dropdown",src:n(32654).Z,width:"497",height:"313"}))),(0,r.kt)("h2",{id:"how-it-works"},"How It Works"),(0,r.kt)("p",null,"When each session request is completed, the session is sent to the Memcached node for the backup. This session remains available on the original application server and can be used for serving the next request. After the second request completion, the session is updated in the Memcached."),(0,r.kt)("p",null,"If the original server fails, the next request is routed to another application server. The newly requested server is asked for the session it doesn\u2019t know. So this new server will find the needed session in the Memcached node. It is identified according to the ID that was appended to the sessionID while session creation. As a result the server can fetch the session from the Memcached node."),(0,r.kt)("p",null,"When the server answers the request, it also updates the session in the Memcached node. Thus there is no interruption of the app caused by the original server failure - the failover is successfully handled."),(0,r.kt)("p",null,"At the same time, the NGINX load balancer is distributing traffic across the cluster containing HTTP resources. You can ",(0,r.kt)("a",{parentName:"p",href:"https://cloudmydc.com/"},"check the load balancing")," in the platform using different load balancing tools."),(0,r.kt)("h2",{id:"how-to-configure"},"How to Configure"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Navigate to your environment in the dashboard and click ",(0,r.kt)("strong",{parentName:"p"},"Config")," button for Apache.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the opened tab go to ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"etc > php.ini")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add the next line to ",(0,r.kt)("strong",{parentName:"p"},"Dynamic Extensions"),":"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"extension=memcached.so\n")),(0,r.kt)("div",{style:{display:"flex",justifyContent:"center",margin:"0 0 1rem 0"}},(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Locale Dropdown",src:n(39454).Z,width:"686",height:"334"}))),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Make the changes in the ",(0,r.kt)("strong",{parentName:"li"},"[Session]")," block:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'session.save_handler = memcached\nsession.save_path = "< server >:11211"\n')),(0,r.kt)("div",{style:{display:"flex",justifyContent:"center",margin:"0 0 1rem 0"}},(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Locale Dropdown",src:n(9230).Z,width:"786",height:"302"}))),(0,r.kt)("admonition",{title:"Note",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"< server> states for memcached IP or URL which you can find by clicking ",(0,r.kt)("strong",{parentName:"p"},"Info")," button for the memcached node in your environment.")),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"Save the changes and restart the ",(0,r.kt)("strong",{parentName:"li"},"Apache")," node.")),(0,r.kt)("p",null,"That\u2019s all! Now if one of the instances fails, the users get automatically switched to the other instance in this cluster and never notice any change."))}h.isMDXComponent=!0},9230:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/f457dd6958c0f2e8b2e812e113c168e6session-save-path-1d39e993f55de101920b803d2c5189b8.png"},39454:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/memcached-enabling-c4cf6ceaacd78289bac9159a1d576ad4.png"},15100:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/memcached-environment-02d269b1a123467cf4279019ada705cc.png"},32654:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/phpcluster4-40c932768fdac1e3c76fda1755afe269.png"}}]);