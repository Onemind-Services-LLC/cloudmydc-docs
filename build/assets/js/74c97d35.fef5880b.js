"use strict";(self.webpackChunkcloudmydc_docs=self.webpackChunkcloudmydc_docs||[]).push([[6217],{3905:(e,t,o)=>{o.d(t,{Zo:()=>p,kt:()=>m});var i=o(7294);function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function a(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function r(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,i,n=function(e,t){if(null==e)return{};var o,i,n={},a=Object.keys(e);for(i=0;i<a.length;i++)o=a[i],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)o=a[i],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var s=i.createContext({}),d=function(e){var t=i.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):r(r({},t),e)),o},p=function(e){var t=d(e.components);return i.createElement(s.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},h=i.forwardRef((function(e,t){var o=e.components,n=e.mdxType,a=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=d(o),h=n,m=c["".concat(s,".").concat(h)]||c[h]||u[h]||a;return o?i.createElement(m,r(r({ref:t},p),{},{components:o})):i.createElement(m,r({ref:t},p))}));function m(e,t){var o=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=o.length,r=new Array(a);r[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:n,r[1]=l;for(var d=2;d<a;d++)r[d]=o[d];return i.createElement.apply(null,r)}return i.createElement.apply(null,o)}h.displayName="MDXCreateElement"},9972:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var i=o(7462),n=(o(7294),o(3905));const a=JSON.parse('{"p":["LABEL maintainer=\'Virtuozzo\'","ENV WILDFLY_VERSION 13.0.0.Final","","ENV ADMIN_USER jelastic","","ENV ADMIN_PASSWORD jelastic"],"y":["RUN cd /opt && curl -O https://download.jboss.org/wildfly/${WILDFLY_VERSION}/wildfly-${WILDFLY_VERSION}.tar.gz \\\\ ","&& $(which tar) xf wildfly-${WILDFLY_VERSION}.tar.gz   ","&& rm wildfly-${WILDFLY_VERSION}.tar.gz"]}'),r={sidebar_position:9},l=void 0,s={unversionedId:"Container/Building Custom Container",id:"Container/Building Custom Container",title:"Building Custom Container",description:"With the platform, the process of preparing your own Docker image can be greatly simplified by building it on the basis of the already existing one (namely - on the top of the platform CentOS 7 base template). This allows to skip all the steps, that are already accomplished within that \u201cparent\u201d template, and add the required adjustments only. We\u2019ll consider this procedure on the example of preparing custom WildFly image - flexible and lightweight Java application server, which is a direct successor of the popular JBoss one.",source:"@site/docs/Container/Building Custom Container.md",sourceDirName:"Container",slug:"/Container/Building Custom Container",permalink:"/docs/Container/Building Custom Container",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Container/Building Custom Container.md",tags:[],version:"current",sidebarPosition:9,frontMatter:{sidebar_position:9},sidebar:"tutorialSidebar",previous:{title:"Private Registry inside PaaS",permalink:"/docs/Container/Private Registry inside PaaS"}},d={},p=[{value:"Composing Dockerfile",id:"composing-dockerfile",level:2}],c={toc:p},u="wrapper";function h(e){let{components:t,...r}=e;return(0,n.kt)(u,(0,i.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"With the platform, the process of preparing your own Docker image can be greatly simplified by building it on the basis of the already existing one (namely - on the top of the platform ",(0,n.kt)("strong",{parentName:"p"},"CentOS 7")," base template). This allows to skip all the steps, that are already accomplished within that \u201cparent\u201d template, and add the required adjustments only. We\u2019ll consider this procedure on the example of preparing custom ",(0,n.kt)("a",{parentName:"p",href:"https://cloudmydc.com/"},"WildFly")," image - flexible and lightweight Java application server, which is a direct successor of the popular JBoss one."),(0,n.kt)("div",{style:{display:"flex",justifyContent:"center",margin:"0 0 1rem 0"}},(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Locale Dropdown",src:o(2450).Z,width:"709",height:"242"}))),(0,n.kt)("p",null,"The most common way of building Docker images is composing a ",(0,n.kt)("strong",{parentName:"p"},(0,n.kt)("em",{parentName:"strong"},"Dockerfile"))," - special manifest, which allows achieving the additional automation through listing the desired commands into a simple text file, which will be read and executed by Docker daemon. In such a way, a new template will be created automatically basing on the comprised instructions (while otherwise, you need to call every necessary operation manually, one by one)."),(0,n.kt)("p",null,"Below, we\u2019ll consider all the specifics of a custom image running at our platform, and, as a result, you\u2019ll get the ready-to-work dockerized version of the WildFly server right inside the platform."),(0,n.kt)("p",null,"So, let\u2019s walk through the required operations step-by-step:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://cloudmydc.com/"},"composing dockerfile")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://cloudmydc.com/"},"adding image to repository")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://cloudmydc.com/"},"deploying image at the platform"))),(0,n.kt)("h2",{id:"composing-dockerfile"},"Composing Dockerfile"),(0,n.kt)("p",null,"To start with, create an empty text file - we\u2019ll declare all the appropriate operations directly in it - and proceed with the following instructions."),(0,n.kt)("admonition",{title:"Note",type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"This sections is exploratory in its nature and includes just the required basis for your dockerfile preparation. However, if you\u2019d like to dive into the specifics of the process and get more detailed guidance, you can examine the official ",(0,n.kt)("a",{parentName:"p",href:"https://cloudmydc.com/"},"dockerfile references"),"."),(0,n.kt)("p",{parentName:"admonition"},"Also, you can ",(0,n.kt)("a",{parentName:"p",href:"https://cloudmydc.com/"},"download")," the already prepared dockerfile (with our WildFly image example) in advance and just look through this section for the performed actions explanations, skipping the manual file creation.")),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"The initial step is specifying the base template for our image building - we\u2019ll use the jelasticdocker/jelastic-centos7-base one with the already configured ",(0,n.kt)("strong",{parentName:"li"},"CentOS 7")," operating system inside. In order to set this within dockerfile, the FROM instruction should be used:")),(0,n.kt)("div",{style:{width:"100%",border:"1px solid #eee",borderRadius:"7px",boxShadow:"rgba(0, 0, 0, 0.16) 0px 1px 4px",overflow:"hidden",margin:"0 0 1rem 0",background:"white"}},(0,n.kt)("div",{style:{display:"flex"}},(0,n.kt)("div",{style:{width:"5%",background:"red",padding:"10px 20px 10px 20px",color:"white"}},"1"),(0,n.kt)("div",{style:{padding:"10px 20px 5px 20px"}},"FROM jelasticdocker/jelastic-centos7-base:latest"))),(0,n.kt)("ol",{start:2},(0,n.kt)("li",{parentName:"ol"},"Next, you can specify the general image information (like metadata or some internal variables), which will be required during the further configurations. Use the example below to set the needed values:")),(0,n.kt)("div",{style:{width:"100%",border:"1px solid #eee",borderRadius:"7px",boxShadow:"rgba(0, 0, 0, 0.16) 0px 1px 4px",overflow:"hidden",margin:"0 0 1rem 0",background:"white"}},a.p.map(((e,t)=>(0,n.kt)("div",{key:t,style:{display:"flex"}},(0,n.kt)("div",{style:{width:"5%",background:"red",padding:t!==a.p.length-1?"10px 20px 5px 20px":"10px 20px 10px 20px",color:"white"}},t+1),(0,n.kt)("div",{style:{padding:t!==a.p.length-1?"10px 20px 5px 20px":"10px 20px 10px 20px"}},e))))),(0,n.kt)("p",null,"where:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"LABEL"),"- allows you to set image metadata via the appropriate key-value pairs (e.g. the author of the Docker image, its version, etc.)"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"ENV"),"- sets the main environment variables, i.e.:",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"WILDFLY_VERSION")," - version of WildFly to build; can be changed to another release if necessary (get the list of the currently ",(0,n.kt)("a",{parentName:"li",href:"https://cloudmydc.com/"},"available versions"),")"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"ADMIN_USER")," - the arbitrary administrator name for the subsequent accessing WildFly admin panel"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("em",{parentName:"li"},"ADMIN_PASSWORD"),"- the desired password for the specified user")))),(0,n.kt)("ol",{start:3},(0,n.kt)("li",{parentName:"ol"},"Now, you can declare the required configurations using the shell commands - the RUN operator should be used for this purpose.")),(0,n.kt)("p",null,"First of all, you need to install the Java Development Kit (",(0,n.kt)("strong",{parentName:"p"},"OpenJDK")," of the 8th version in our case) and the tar archiver (which will be used for decompressing the downloaded files):"),(0,n.kt)("div",{style:{width:"100%",border:"1px solid #eee",borderRadius:"7px",boxShadow:"rgba(0, 0, 0, 0.16) 0px 1px 4px",overflow:"hidden",margin:"0 0 1rem 0",background:"white"}},(0,n.kt)("div",{style:{display:"flex"}},(0,n.kt)("div",{style:{width:"5%",background:"red",padding:"10px 20px 10px 20px",color:"white"}},"1"),(0,n.kt)("div",{style:{padding:"10px 20px 5px 20px"}},"RUN yum -y install java-1.8.0-openjdk-devel tar && yum -y update;"))),(0,n.kt)("p",null,"This command ends with calling the installed packages' general update."),(0,n.kt)("ol",{start:4},(0,n.kt)("li",{parentName:"ol"},"Next, let\u2019s declare a few additional operations for downloading the WildFly source code from the official website and extracting it to the ",(0,n.kt)("strong",{parentName:"li"},"/opt")," folder.")),(0,n.kt)("div",{style:{width:"100%",border:"1px solid #eee",borderRadius:"7px",boxShadow:"rgba(0, 0, 0, 0.16) 0px 1px 4px",overflow:"hidden",margin:"0 0 1rem 0",background:"white"}},a.y.map(((e,t)=>(0,n.kt)("div",{key:t,style:{display:"flex"}},(0,n.kt)("div",{style:{width:"5%",background:"red",padding:t!==a.p.length-1?"10px 20px 5px 20px":"10px 20px 10px 20px",color:"white"}},t+1),(0,n.kt)("div",{style:{padding:t!==a.p.length-1?"10px 20px 5px 20px":"10px 20px 10px 20px"}},e))))),(0,n.kt)("ol",{start:5},(0,n.kt)("li",{parentName:"ol"},"At this step, you need to create a symlink in order to shorten the path to the WildFly main directory and, as a result, to make it easily accessible:")),(0,n.kt)("p",null,"1\nRUN ln -s /opt/wildfly-$WILDFLY_VERSION /opt/wildfly 6. Let\u2019s proceed with creation of the main configuration file for our WildFly server and putting all the needed options to it:"),(0,n.kt)("p",null,'1\n2\n3\n4\n5\n6\n7\n8\n9\nRUN echo -en "JAVA_HOME=\\"/usr/lib/jvm/java\\""\'\\n\'\\\n"JBOSS_HOME=\\"/opt/wildfly\\""\'\\n\'\\\n"JBOSS_USER=wildfly"\'\\n\'\\\n"JBOSS_MODE=standalone"\'\\n\'\\\n"JBOSS_CONFIG=standalone.xml"\'\\n\'\\\n"STARTUP_WAIT=60"\'\\n\'\\\n"SHUTDOWN_WAIT=60"\'\\n\'\\\n"JBOSS_CONSOLE_LOG=\\"/var/log/wildfly/console.log\\""\'\\n\'\\\n"JBOSS_OPTS=\\"-b 0.0.0.0 -bmanagement=0.0.0.0 -Djboss.management.http.port=4949 -Djboss.management.https.port=4848\\"" >> /etc/default/wildfly 7. CentOS 7 is started using the Systemd initiation script by default, but WildFly server requires the more traditional SystemV Init one, thus you need to copy the default initscript to the /etc/init.d folder and edit the appropriate configs to avoid the systemd redirect:'),(0,n.kt)("p",null,"1\n2\nRUN wget ",(0,n.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/wildfly/wildfly-core/master/core-feature-pack/src/main/resources/content/docs/contrib/scripts/init.d/wildfly-init-redhat.sh"},"https://raw.githubusercontent.com/wildfly/wildfly-core/master/core-feature-pack/src/main/resources/content/docs/contrib/scripts/init.d/wildfly-init-redhat.sh")," -O /etc/rc.d/init.d/wildfly;",(0,n.kt)("br",{parentName:"p"}),"\n",'sed -i "/# Source function library/a\\SYSTEMCTL_SKIP_REDIRECT=1" /etc/init.d/wildfly; chmod +x /etc/init.d/wildfly; 8. Next, we\u2019ll state WildFly to be run on container startup by adding the corresponding system user and changing files\' ownership for him:'),(0,n.kt)("p",null,"1\n2\nRUN chkconfig --add wildfly; chkconfig wildfly on; mkdir -p /var/log/wildfly; adduser wildfly;",(0,n.kt)("br",{parentName:"p"}),"\n","chown -R wildfly:wildfly /opt/wildfly-$WILDFLY_VERSION /opt/wildfly /var/log/wildfly; 9. Also, let\u2019s add the user credentials we\u2019ve defined within the 1st instruction step for accessing the server\u2019s admin panel:"),(0,n.kt)("p",null,"1\nRUN /opt/wildfly/bin/add-user.sh --user $ADMIN_USER --password $ADMIN_PASSWORD --silent --enable 10. Now, we can correct a link to the admin panel itself at the default index.html page by defining the corresponding redirect (as in case our image will be deployed to a container without the external IP attached, port 4949 and HTTP connection should be used here):"),(0,n.kt)("p",null,'1\nRUN sed -i "s/<a href=\\"\\/console\\">/<a href=\\"\\/console\\" onclick=\\"javascript:event.target.port=4949;event.target.protocol=\\\'http:\\\';\\">/" /opt/wildfly/welcome-content/index.html 11. Add the English locale settings to the container.'),(0,n.kt)("p",null,"1\nRUN localedef -i en_US -f UTF-8 en_US.UTF-8 12. Another required action is to set our Docker image to listen to the required ports at the runtime. The EXPOSE instruction is intended for this:"),(0,n.kt)("p",null,"1\nEXPOSE 22 80 443 8080 8743 9990 9993 8009 4848 4949 13. Lastly, you need to set the ENTRYPOINT for defining a container to be run as executable. In our case, the bash shell should be specified:"),(0,n.kt)("p",null,"1\nENTRYPOINT ",'["/bin/bash"]',"\nThat\u2019s all! Just don\u2019t forget to save all the declared settings to get the ready-to-go dockerfile."),(0,n.kt)("p",null,"Adding Image to Repository\nOnce the proper dockerfile is prepared, you are ready to build your WildFly image on its base and, subsequently, push it to the repository."),(0,n.kt)("p",null,"Note: Before starting, ensure you have the appropriate Docker CE version (according to the used OS type) installed for executing the below described commands at the currently used machine.\nSo, follow the next steps to accomplish that:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Run the docker build command with the required parameters to create a new image locally:")),(0,n.kt)("p",null,"1\nsudo docker build -t {image_name} {dockerfile_location}\nwhere"),(0,n.kt)("p",null,"{image_name} - image repository appellation; optionally, a version tag could be added after the \u201c:\u201d separator (e.g. jelastic/wildfly:latest)\n{dockerfile_location} - either local path or an URL to your dockerfile (could be set as \u201c.\u201d if the file is located in the current directory) 2. You should receive the build success message with the ID of your new image alongside. To ensure it is available at your workstation, you can request the list of all local templates to be output with:"),(0,n.kt)("p",null,"1\nsudo docker images 3. Finally, you need to push (upload) your image to a registry with the corresponding command:"),(0,n.kt)("p",null,"1\nsudo docker push {image_name}\nHere, {image_name} should be stated the same to the one you\u2019ve specified during the image building in the 1st step."),(0,n.kt)("p",null,"You\u2019ll be additionally requested to confirm your account ownership (by specifying the corresponding username, password and email address) in order to complete this operation."),(0,n.kt)("p",null,"Tip: You can log into the registry in advance using the corresponding docker login command (as a result, your credentials will be stored in the ~/.docker/config.json file at your local user\u2019s home directory).\nDeploying Image at Platform\nAs soon as your image is successfully stored at the repository, it becomes available for usage at the platform and can be added to an environment through the dedicated Docker board integrated to the topology wizard dashboard sections."),(0,n.kt)("p",null,"So, select the New Environment button at the top of the dashboard, move to the Docker tab within the opened environment wizard and click on the Select Image button."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Here, you can use either the Search tab (for adding an image from Docker Hub repository) or switch to the Custom section, where you can operate images of any type (i.e. including the private ones) and store your templates for being easily accessible.")),(0,n.kt)("p",null,"add new custom image"),(0,n.kt)("p",null,"We\u2019ll consider the latter one, so, once inside, choose the necessary environment layer to the left (App. Servers in our case) and click the Add New Image button."),(0,n.kt)("ol",{start:2},(0,n.kt)("li",{parentName:"ol"},"At the opened Add New Image frame, type your image identifier within the Name field, i.e.:")),(0,n.kt)("p",null,"{registry_hostname}(can be skipped for official Hub Registry)/{account}/{image_name}"),(0,n.kt)("p",null,"Also, in case of a private repository usage, the appropriate Username and Password credentials should be specified."),(0,n.kt)("p",null,"custom image repository"),(0,n.kt)("p",null,"We use the public Docker Hub repository, located within the central Registry Hub, so only the short repository name is required. Click Add when ready."),(0,n.kt)("ol",{start:3},(0,n.kt)("li",{parentName:"ol"},"After that, your image will appear in the list. Out of here, it could be added to the topology with just a single click. Moreover, this template will be remembered and remain listed here so it can be easily found during the consequent container selections (until you remove it from the Custom list manually).")),(0,n.kt)("p",null,"create custom WildFly image"),(0,n.kt)("p",null,"Set the rest of the necessary configurations on your own (the details on the available options can be read in the linked guide) and finish the environment creation."),(0,n.kt)("ol",{start:4},(0,n.kt)("li",{parentName:"ol"},"Once your environment with the appropriate image inside appears on the dashboard, it can be accessed using the corresponding Open in Browser button:")),(0,n.kt)("p",null,"WildFly open in browser"),(0,n.kt)("p",null,"Note: In case you haven\u2019t placed your template to the App. Servers or Balancing environment layer, you\u2019ll need to use the same-named button next to a particular container to open it.\nAs a result, you\u2019ll see the default WildFly start page, which means everything is correctly configured and your newly created container is fully operational."),(0,n.kt)("p",null,"custom WildFly home page"),(0,n.kt)("p",null,"Similarly to the described above, you can create any other preconfigured image due to your purposes and, consequently, easily run it within the platform!"))}h.isMDXComponent=!0},2450:(e,t,o)=>{o.d(t,{Z:()=>i});const i=o.p+"assets/images/01-building-wildfly-docker-image-b0ef48035ae9ae3df748bbd866964294.png"}}]);