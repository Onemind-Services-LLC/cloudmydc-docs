"use strict";(self.webpackChunkcloudmydc_docs=self.webpackChunkcloudmydc_docs||[]).push([[1241],{3905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>h});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=n.createContext({}),l=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},m=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),d=l(a),u=r,h=d["".concat(c,".").concat(u)]||d[u]||p[u]||o;return a?n.createElement(h,s(s({ref:t},m),{},{components:a})):n.createElement(h,s({ref:t},m))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,s=new Array(o);s[0]=u;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[d]="string"==typeof e?e:r,s[1]=i;for(var l=2;l<o;l++)s[l]=a[l];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},79738:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var n=a(87462),r=(a(67294),a(3905));const o={sidebar_position:3},s=void 0,i={unversionedId:"Memcached/Memcached Memory Allocation",id:"Memcached/Memcached Memory Allocation",title:"Memcached Memory Allocation",description:"Memcached, system of the distributed memory caching, is often used to increase the performance and availability of the hosted application through decreasing database load. It creates a common cache for all the application nodes and represents your application short-term memory.",source:"@site/docs/Memcached/Memcached Memory Allocation.md",sourceDirName:"Memcached",slug:"/Memcached/Memcached Memory Allocation",permalink:"/docs/Memcached/Memcached Memory Allocation",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Memcached/Memcached Memory Allocation.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Memcached Configuration",permalink:"/docs/Memcached/Memcached Configuration"},next:{title:"PHP Sessions Clustering",permalink:"/docs/Memcached/PHP Sessions Clustering"}},c={},l=[],m={toc:l},d="wrapper";function p(e){let{components:t,...o}=e;return(0,r.kt)(d,(0,n.Z)({},m,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Memcached"),", system of the distributed memory caching, is often used to increase the performance and availability of the hosted application through decreasing database load. It creates a common cache for all the application nodes and represents your application short-term memory."),(0,r.kt)("p",null,"Let\u2019s find out how the ",(0,r.kt)("strong",{parentName:"p"},"memory allocation")," in Memcached works and in what way can we get rid of memory fragmentation while using the platform."),(0,r.kt)("p",null,"Memcached system uses the ",(0,r.kt)("strong",{parentName:"p"},"slab")," instead of the item-by-item memory allocation. As a result it improves the usage of the memory and protects it from the fragmentation in case the data expires from the cache."),(0,r.kt)("p",null,"Each slab consists of several 1 MB size pages and each page, in its turn, consists of the equal amount of blocks or chunks. After every data storing the Memcached defines the data size and looks for a suitable allocation in all slabs. If such allocation exists, the data is written to it. If there is no suitable allocation, the Memcached creates a new slab and divides it into the blocks of the necessary size. In the case you update the already stored item and its new value exceeds the size of the block allocation it was stored in before, Memcached moves it to another, suitable slab."),(0,r.kt)("div",{style:{display:"flex",justifyContent:"center",margin:"0 0 1rem 0"}},(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Locale Dropdown",src:a(44759).Z,width:"501",height:"380"}))),(0,r.kt)("p",null,"As a result, every instance has multiple pages distributed and allocated within the Memcached memory. This method of allocation prevents the memory fragmentation. But on the other hand it can cause the waste of memory if you have not enough amount of items with equal allocation size, i.e. there are only a few filled chunks in every page. Thus one more important point is the distribution of the stored items."),(0,r.kt)("p",null,"With the platform, you get a possibility to modify the slab growth coefficient right during your application is running. For that click the ",(0,r.kt)("strong",{parentName:"p"},"Config")," button next to the Memcached node, navigate to the ",(0,r.kt)("strong",{parentName:"p"},"conf")," directory and open ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"memcached"))," file. Edit it, e.g. in the following way:"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},'OPTIONS="-vv 2>> /var/log/memcached/memcached.log -f 2 -n 32"')),(0,r.kt)("div",{style:{display:"flex",justifyContent:"center",margin:"0 0 1rem 0"}},(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Locale Dropdown",src:a(82526).Z,width:"656",height:"147"}))),(0,r.kt)("p",null,"In this example ",(0,r.kt)("strong",{parentName:"p"},"-f 2")," specifies that you will see 14 slabs with doubled size of chunks, and the value after the ",(0,r.kt)("strong",{parentName:"p"},"-n")," defines the minimum space allocated for the key, flags and value."),(0,r.kt)("p",null,"We\u2019ve got the following results:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Chunk details"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"#  Item_Size  Max_age   Pages   Count   Full?  Evicted Evict_Time    OOM\n3     320B       550s       1     113     yes        0        0       0\n4     640B       681s       1     277     yes        0        0       0\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Memory usage"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"total          used        free      shared    buffers     cached\nMem:           128          84         43          0          0         70\n-/+ buffers/cache:          14        113\nSwap:            0            0\n")),(0,r.kt)("p",null,"Now let\u2019s enter the default settings again and check what values we\u2019ll get:"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},'OPTIONS="-vv 2>> /var/log/memcached/memcached.log"')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Chunk details"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"#  Item_Size  Max_age   Pages   Count   Full?  Evicted Evict_Time OOM\n5     240B       765s       1      27     yes        0        0     0\n6     304B       634s       1      93     yes        0        0     0\n7     384B       634s       1     106     yes        0        0     0\n8     480B       703s       1     133     yes        0        0     0\n9     600B       634s       1      57     yes        0        0     0\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Memory usage"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"total       used       free     shared    buffers     cached\nMem:           128         87         40          0          0         70\n-/+ buffers/cache:         17        110\nSwap:            0          0          0\n")),(0,r.kt)("p",null,"Also you can add the ",(0,r.kt)("strong",{parentName:"p"},"-L")," parameter to increase the memory page size and in such a way reduce the number of TLB misses and improve the performance."),(0,r.kt)("p",null,"Thanks to this easy and straightforward optimization we can improve the usage of the allocated memory."))}p.isMDXComponent=!0},44759:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/1-cba613d7c46f4159884587365a8bd1f8.png"},82526:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/memcached-config-4f54fdedd6d420963c76c478902d2692.png"}}]);